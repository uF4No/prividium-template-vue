# Web App - ZKsync Prividiumâ„¢ Integration

A Vue 3 + TypeScript sample application demonstrating secure smart contract interactions through Prividium Proxy API.

## Current Scope

This app includes both:

- OIDC authentication with Prividium
- Passkey-based SSO smart account setup (create/select + deploy/link)

## Overview

This sample dApp showcases how to build a secure Web3 application that:

- Authenticates users through OIDC
- Creates or selects passkeys for SSO account access
- Deploys SSO smart accounts through the backend
- Links deployed wallets to the authenticated Prividium user profile
- Interacts with smart contracts on ZKsync Prividium chain through the Prividium proxy
- Implements proper transaction signing 

## Features

- **Secure Authentication**: OAuth 2.0/OpenID Connect integration
- **SSO Setup Flow**: Passkey creation/selection plus guided two-step account setup UI
- **Profile Wallet Linking**: New smart account is linked to the user profile by backend `/deploy-account`
- **Smart Contract Interaction**: Complete CRUD operations on a Counter contract
- **Transaction Management**: Real-time transaction history and status tracking
- **Proxy Integration**: All RPC calls routed through authenticated Prividium proxy
- **Responsive Design**: Modern UI with CSS custom properties and responsive layout

## Prerequisites

- Node.js 18+ and pnpm
- MetaMask browser extension
- Access to ZKsync Prividium chain
- Running Prividium proxy service

## Architecture

### Tech Stack

- **Vue 3**: Composition API with TypeScript
- **Viem**: Ethereum library for wallet and contract interactions
- **Wagmi**: React hooks for Ethereum (Vue port)
- **Vite**: Build tool and development server

### Key Components

#### Authentication Flow

- **Login**: OIDC OAuth 2.0 with PKCE flow
- **Setup**: user chooses `Create New Passkey` or `Use Existing`
- **Deploy & Link**: for new passkeys, web-app calls backend `/deploy-account` with `userId`
- **Confirmation**: setup card shows deployed address and explicit `Continue to App` action
- **Protected Routes**: automatic redirection based on auth state


## Smart Contract Interface

The sample interacts with a Counter contract with the following functions:

### Read Functions

- `x()`: Returns current counter value

### Write Functions

- `inc()`: Increments the counter by 1
- `incBy(uint256)`: Increments the counter by a specific amount

## Authentication & Security

### OIDC Integration

- OAuth 2.0 Authorization Code flow with PKCE
- Secure token storage and automatic refresh
- ID token passed to Prividium proxy for authorization

### Account Linking Model

- For **new passkeys**, the frontend sends `userId`, `originDomain`,
  `credentialId`, and `credentialPublicKey` to backend `/deploy-account`.
- The backend deploys the smart account, configures permissions, and links the
  wallet to the Prividium profile with admin credentials.
- The frontend does **not** call `/api/user-wallets/associate` for this flow.
- For **existing passkeys**, the frontend only selects and validates an already
  linked account.

### Network Security

- All blockchain interactions routed through authenticated proxy
- Permission-based access control via Prividium
- No direct RPC endpoint exposure

## Development Commands

Run these from the `web-app` directory or use `pnpm --filter web-app <command>` from the root.

```bash
# Development
pnpm dev          # Start development server
pnpm preview      # Preview production build

# Build & Type Checking
pnpm build        # Full production build
pnpm build-only   # Build without type checking
pnpm typecheck    # TypeScript type checking only
```

## Environment Variables

> Contract addresses are generated by the setup scripts and written into `web-app/.env`.  
> Do not edit these manually; use `pnpm -C setup refresh:env` after running setup.

| Variable                              | Description                                          | Example                          |
| ------------------------------------- | ---------------------------------------------------- | -------------------------------- |
| `VITE_PRIVIDIUM_API_URL`              | Prividium API base URL (include `/api`)              | `http://localhost:8000/api`     |
| `VITE_PRIVIDIUM_RPC_URL`              | Prividium RPC URL                                    | `http://localhost:8000/rpc`     |
| `VITE_PRIVIDIUM_AUTH_BASE_URL`        | Prividium Auth base URL                              | `http://localhost:3001`         |
| `VITE_PRIVIDIUM_CHAIN_ID`             | Prividium chain ID                                   | `6565`                           |
| `VITE_PRIVIDIUM_CHAIN_NAME`           | Prividium chain display name                         | `Prividium`                      |
| `VITE_PRIVIDIUM_NATIVE_CURRENCY_SYMBOL` | Native currency symbol                             | `ETH`                            |
| `VITE_COUNTER_CONTRACT_ADDRESS`       | Counter contract address                             | `0x123...`                       |
| `VITE_CLIENT_ID`                      | OAuth client id (created by setup)                   | `abc123`                         |
| `VITE_BACKEND_URL`                    | Backend service base URL (SSO deploy endpoint)       | `http://localhost:4340`          |
| `VITE_SSO_WEBAUTHN_VALIDATOR`         | SSO WebAuthn validator                               | `0x...`                          |
| `VITE_SSO_ENTRYPOINT`                 | SSO EntryPoint                                       | `0x...`                          |
| `VITE_SSO_CHAIN_ID`                   | SSO chain id (optional override)                     | `6565`                           |
| `VITE_SSO_CHAIN_NAME`                 | SSO chain name (optional override)                   | `Prividium`                      |

> **Note**: The sample dApp uses the authenticated `/rpc` endpoint for direct contract interaction calls. Network
> configuration (including personal RPC endpoints) should be done through the **user-panel** application.
