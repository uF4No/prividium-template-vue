# Prividium Template - Vue & Foundry Monorepo

Welcome to the ZKsync Prividium™ template! This monorepo provides a complete starting point for building privacy-focused decentralized applications on Prividium™ chains.
 
## Using this template

This template is a starting point for building privacy-focused decentralized applications on Prividium™ chains. It includes a basic counter contract, a setup script to deploy contracts and configure permissions for the sample counter contract in the ZKsync Prividium™ ecosystem, a Node.js backend service necessary for ZKsync SSO Smart Account counterfactual deployment, and a Vue 3 + TypeScript frontend demonstrating Prividium authentication and secure RPC proxying to interact with smart contracts.

### Branding and style customization

The web app can be easily updated to use different branding by updating the following environment variables in the `web-app/.env` file:

```sh
# Company name
VITE_COMPANY_NAME="Matter Labs"
# Accent color (hex)
VITE_ACCENT_COLOR="#3a00adff"
# Company icon (from https://heroicons.com/)
VITE_COMPANY_ICON="ArrowPathRoundedSquareIcon"
```

## Repository Structure

- [`setup/`](./setup): Setup scripts to deploy contracts and configure permissions for the sample counter contract in the ZKsync Prividium™ ecosystem. Can be easily extended to support multiple contracts.
- [`contracts/`](./contracts): A basic Foundry-based project with a sample counter contract. You can add other contracts here.
- [`backend/`](./backend): A Node.js backend service necessary for ZKsync SSO Smart Account counterfactual deployment and interop transactions.
- [`web-app/`](./web-app): A Vue 3 + TypeScript frontend demonstrating Prividium authentication and secure RPC proxying to interact with smart contracts.

## Configuration Source of Truth

Contract addresses live in a single canonical file:

- `config/contracts.json`

This file is **generated by the setup scripts**. Do not edit contract addresses manually in `.env` files.  
If you need to refresh env files from the canonical config, run:

```bash
pnpm -C setup refresh:env
```

## Requirements

### System requirements

- Node.js v22.10.0 or higher
- pnpm v9.16.1 or higher
- Foundry v1.0.0 or higher
- Docker

### Prividium base chain

This project requires a target ZKsync Prividium™ chain to connect to. You can either run a local Prividium instance following the instructions in the [local Prividium repo](https://github.com/matter-labs/local-prividium) (requires access to private Docker registry) or use a remote Prividium instance.

> [!NOTE]
> Make sure the Prividium chain is running with the Bundler service enabled. It requires configuring the permissions API with the following env vars:

```sh
# Bundler (ERC-4337) Configuration
# Set BUNDLER_ENABLED=true to enable bundler RPC methods
BUNDLER_ENABLED=true
BUNDLER_RPC_URL=http://localhost:4337

```

## Quick Start

> [!IMPORTANT]
> You need to have a Prividium base chain running with the Bundler service enabled. See the [Prividium base chain](#prividium-base-chain) section for more information.

### 1. Install Dependencies

This project uses `pnpm` workspaces. Install everything from the root:

```bash
pnpm install
```

### 2. Compile app contracts

Compile the app contracts (e.g. Counter) with:

```bash
pnpm --filter contracts build
```

### 3. Pre-deploy contracts and permissions

The setup script deploys the SSO smart contracts (beacon, factory and account implementation) and configures permissions for the SSO contracts. It also creates the app client via the Prividium API and deploys the app specific contracts (e.g. Counter). Finally, it configures permissions for the app specific contracts.

Configure the `.env` file in the `setup/` directory with the required env vars and endpoints to your target Prividium chain and API, app client name etc. See the `setup/.env.example` as reference:

```sh
ADMIN_PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
ADMIN_ADDRESS=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
PERMISSIONS_API_URL=http://localhost:8000
AUTH_BASE_URL=http://localhost:3001
PROXY_URL=http://localhost:8000/rpc
CHAIN_ID=6565
CONTRACTS_CONFIG_PATH="../config/contracts.json"
```

Run the setup script with:

```sh
pnpm setup
```

You'll see the progress of the deployment and app creation on the terminal. Contract addresses will be stored in `config/contracts.json`.

Finally, the job synchronizes contract addresses to the `.env` files in the `web-app/` and `backend/` directories.

### 4. SSO Smart Account Configuration

As this demo uses ZKsync SSO smart accounts, the `DISPATCHER_SSO_BYTECODE_HASHES` and `DISPATCHER_SSO_IMPLEMENTATIONS` are required in the Prividium Permissions API. 

Update the Permissions API `.env` file (or pass this values via Dockerfile) to include the following values. The `DISPATCHER_SSO_IMPLEMENTATIONS` is the address of the SSO account implementation deployed in the previous step. 

```sh
# SSO Smart Account Dispatcher Configuration (optional)
# Used for verifying smart account proxy contracts

# SSO implementation contract address
DISPATCHER_SSO_IMPLEMENTATIONS=0x998abeb3e57409262ae5b751f60747921b33613e
# Calculated with cast keccak $(cast code SMART_ACCOUNT_ADDRESS --rpc-url http://localhost:5050)
DISPATCHER_SSO_BYTECODE_HASHES=0x77a9210e5f94158c7e8f7e84e9601f427e8c1d5f09dfd434afd16314456b0a0f
```

> [!NOTE]
> After updating the `.env` file for the permissions API, restart all Prividium services.

### 5. Start Backend service

The backend service (in `./backend`) provides different endpoints to allow the deployment of the SSO smart contract accounts from the web app (in `./web-app`). This service requires multiple environment variables like the Prividium endpoints (RPC, auth, api), the SSO contract addresses (factory, beacon, account implementation, webauthn validator, eoa validator, session validator, guardian executor, entry point). Configure them in the `backend/.env` file using the `env.exmaple` as a reference.

```sh
EXECUTOR_PRIVATE_KEY=0x...
L1_RPC_URL=http://127.0.0.1:8545
L2_RPC_URL=http://localhost:8000/rpc
L2_CHAIN_ID=6565
CONTRACTS_CONFIG_PATH=../config/contracts.json
L1_INTEROP_HANDLER=0x...
L2_INTEROP_CENTER=0x...
```

To start the backend service run:

```sh
pnpm dev:backend
```

The backend service also enables interop transactions (optional and not used in this example app) via the the `L1_INTEROP_HANDLER` and `L2_INTEROP_CENTER` env variables.

### 6. Start Web app

The web app (in `./web-app`) is a Vue.js application that allows users to create Passkeys and deploy SSO smart contract accounts. It requires multiple environment variables like the Prividium endpoints (RPC, auth, api), and the Counter contract address. Configure them in the `web-app/.env` file.

<!-- TODO: example env file with just minimal required variables -->
```sh
VITE_PRIVIDIUM_API_URL=http://localhost:8000
VITE_PRIVIDIUM_RPC_URL=http://localhost:8000/rpc
VITE_AUTH_BASE_URL=http://localhost:3001
VITE_CHAIN_ID=6565
VITE_CHAIN_NAME=Prividium
VITE_NATIVE_CURRENCY_SYMBOL=ETH
VITE_CLIENT_ID=your-client-id
VITE_COUNTER_CONTRACT_ADDRESS=0x...
```

To start the web app run:

```sh
pnpm dev:web-app
```

> [!IMPORTANT]
> Start the web app and backend services in separate terminals.

### 7. Use the app

Navigate to http:localhost:3002 and log in with a Prividium user. Create a new passkey and use the app to interact with the Counter contract using passkeys.



## ZKsync SSO Integration

This template includes integration with ZKsync SSO for Passkey-based Smart Accounts.

1.  **Backend**: The `backend` package acts as a deployer. It counterfactually deploys Smart Accounts when a user creates a Passkey in the UI.
2.  **Frontend**: The Login page allows you to "Create Passkey Account". This registers a WebAuthn credential and asks the backend to deploy the account.
3.  **Prividium Linking**: Once the account is created locally, logging in via Prividium (OIDC) will automatically link the deployed Smart Account address to your Prividium User Profile using the Admin API (`PUT /users/{id}`).


## Global Scripts

We provide several convenient scripts at the root level:

- `pnpm build`: Builds all packages (Contracts & Web App).
- `pnpm test`: Runs tests across the entire workspace.
- `pnpm lint`: Runs Biome linter on all supported files.
- `pnpm format`: Automatically formats the codebase using Biome and Forge.
- `pnpm check`: Runs both linting and formatting verification.
- `pnpm -C setup refresh:env`: Sync `.env` files from `config/contracts.json`.


## License

This project is licensed under the MIT License.
